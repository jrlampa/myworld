# ğŸ”„ Fluxo de Deploy e Monitoramento - Diagrama Visual

## ğŸ“Š VisÃ£o Geral dos Workflows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FLUXO COMPLETO DE DEPLOY                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Developer    â”‚
â”‚ Push Code    â”‚â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â”‚
                    â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   1. PRE-DEPLOY CHECKS      â”‚
      â”‚   (pre-deploy.yml)          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ âœ“ Validate files            â”‚
      â”‚ âœ“ Validate secrets          â”‚
      â”‚ âœ“ npm ci                    â”‚
      â”‚ âœ“ TypeScript build          â”‚
      â”‚ âœ“ Frontend build            â”‚
      â”‚ âœ“ Docker build              â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ âœ… Success
                     â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   2. DEPLOY TO CLOUD RUN    â”‚
      â”‚   (deploy-cloud-run.yml)    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ âœ“ Auth to GCP               â”‚
      â”‚ âœ“ Deploy service            â”‚
      â”‚ âœ“ Capture service URL       â”‚
      â”‚ âœ“ Update env vars           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ âœ… Deployment Complete
                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                        â”‚                      â”‚
                     â–¼                        â–¼                      â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ 3. POST-DEPLOY CHECK    â”‚  â”‚ 4. HEALTH CHECK    â”‚  â”‚ 5. CONTINUOUS    â”‚
      â”‚ (post-deploy-check.yml) â”‚  â”‚ (health-check.yml) â”‚  â”‚    MONITORING    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ âœ“ Service exists        â”‚  â”‚ âœ“ /health         â”‚  â”‚ Every 6 hours:   â”‚
      â”‚ âœ“ Service ready         â”‚  â”‚ âœ“ Frontend        â”‚  â”‚                  â”‚
      â”‚ âœ“ URL accessible        â”‚  â”‚ âœ“ Search API      â”‚  â”‚ âœ“ Run full       â”‚
      â”‚ âœ“ Env vars set          â”‚  â”‚ âœ“ AI Analysis     â”‚  â”‚   health check   â”‚
      â”‚ âœ“ Config validated      â”‚  â”‚ âœ“ Elevation API   â”‚  â”‚                  â”‚
      â”‚                         â”‚  â”‚ âœ“ DXF Generation  â”‚  â”‚ âœ“ Alert on fail  â”‚
      â”‚ â±ï¸  ~1-2 minutes        â”‚  â”‚ âœ“ Cloud Tasks     â”‚  â”‚                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ âœ“ Static assets   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚ âœ“ API docs        â”‚
                                   â”‚                    â”‚
                                   â”‚ â±ï¸  ~2-3 minutes   â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Matriz de VerificaÃ§Ã£o

| Check | Pre-Deploy | Deploy | Post-Deploy | Health Check | Continuous |
|-------|------------|--------|-------------|--------------|------------|
| **Build & Compilation** | âœ… | | | | |
| **Docker Build** | âœ… | | | | |
| **Secrets Validation** | âœ… | | | | |
| **GCP Deployment** | | âœ… | | | |
| **Service Configuration** | | | âœ… | | |
| **Service URL** | | | âœ… | | |
| **Env Variables** | | | âœ… | | |
| **Health Endpoint** | | | âœ… | âœ… | âœ… |
| **Frontend Loading** | | | | âœ… | âœ… |
| **API Endpoints** | | | | âœ… | âœ… |
| **DXF Generation** | | | | âœ… | âœ… |
| **AI Analysis** | | | | âœ… | âœ… |
| **Elevation Service** | | | | âœ… | âœ… |
| **Cloud Tasks** | | | | âœ… | âœ… |
| **Static Assets** | | | | âœ… | âœ… |

## ğŸ“ˆ Timeline TÃ­pico

```
0min          5min          10min         15min         20min
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ Pre-Deploy  â”‚   Deploy    â”‚ Post-Deploy â”‚   Health    â”‚
â”‚   Checks    â”‚  Cloud Run  â”‚    Check    â”‚   Check     â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚             â”‚             â”‚             â”‚
â”‚ Validate    â”‚ Build &     â”‚ Verify      â”‚ Test All    â”‚
â”‚ & Build     â”‚ Push        â”‚ Config      â”‚ Features    â”‚
â”‚             â”‚             â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ~3-5min       ~5-8min       ~1-2min       ~2-3min

Total: ~11-18 minutos do push atÃ© deploy completamente verificado
```

## ğŸ”” NotificaÃ§Ãµes e Alertas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CENÃRIOS DE NOTIFICAÃ‡ÃƒO              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… SUCCESS (All Green)
â”œâ”€ Pre-Deploy: PASS
â”œâ”€ Deploy: PASS
â”œâ”€ Post-Deploy: PASS
â””â”€ Health Check: PASS
   â””â”€> ğŸ‰ Deploy SaudÃ¡vel!

âŒ FAILURE (Pre-Deploy)
â”œâ”€ Build Error
â”‚  â””â”€> ğŸš« Deploy Bloqueado
â”‚     â””â”€> Fix & Retry

âš ï¸ WARNING (Post-Deploy)
â”œâ”€ Deploy: PASS
â”œâ”€ Post-Deploy: FAIL (env var missing)
â”‚  â””â”€> ğŸ”§ Fix Config
â”‚     â””â”€> Manual Health Check

âŒ CRITICAL (Health Check)
â”œâ”€ Deploy: PASS
â”œâ”€ Post-Deploy: PASS
â”œâ”€ Health Check: FAIL (API down)
â”‚  â””â”€> ğŸš¨ ALERT!
â”‚     â””â”€> Investigate Immediately
â”‚        â””â”€> Check logs
â”‚           â””â”€> Consider rollback
```

## ğŸ› ï¸ AÃ§Ãµes Recomendadas por Status

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STATUS: âœ… All Checks Passing                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action: Monitor                                              â”‚
â”‚ â€¢ Check metrics every few hours                              â”‚
â”‚ â€¢ Review logs for warnings                                   â”‚
â”‚ â€¢ Continue development                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STATUS: âš ï¸ Post-Deploy Warning                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action: Fix Configuration                                    â”‚
â”‚ â€¢ Review env vars                                            â”‚
â”‚ â€¢ Update Cloud Run service                                   â”‚
â”‚ â€¢ Re-run post-deploy check                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STATUS: âŒ Health Check Failed                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action: Immediate Investigation                              â”‚
â”‚ 1. Check Cloud Run logs                                      â”‚
â”‚ 2. Test endpoints manually                                   â”‚
â”‚ 3. Verify external dependencies (Groq, Elevation API)        â”‚
â”‚ 4. Check resource limits                                     â”‚
â”‚ 5. Consider rollback if critical                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Dashboard Mental (O Que Monitorar)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPLOYMENT DASHBOARD                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  LAST DEPLOY: âœ… 2 hours ago                                â”‚
â”‚  LAST HEALTH CHECK: âœ… 30 minutes ago                       â”‚
â”‚                                                              â”‚
â”‚  CRITICAL METRICS:                                           â”‚
â”‚  â”œâ”€ Health Endpoint: âœ… 200 OK (145ms)                      â”‚
â”‚  â”œâ”€ Frontend: âœ… 200 OK (234ms)                             â”‚
â”‚  â”œâ”€ Search API: âœ… 200 OK (456ms)                           â”‚
â”‚  â”œâ”€ AI Analysis: âœ… 200 OK (1234ms)                         â”‚
â”‚  â”œâ”€ Elevation API: âœ… 200 OK (567ms)                        â”‚
â”‚  â””â”€ DXF Generation: âœ… 202 Accepted (189ms)                 â”‚
â”‚                                                              â”‚
â”‚  ENVIRONMENT:                                                â”‚
â”‚  â”œâ”€ Service: sisrua-app                                      â”‚
â”‚  â”œâ”€ Region: southamerica-east1                               â”‚
â”‚  â”œâ”€ Instances: 1/10                                          â”‚
â”‚  â””â”€ Memory: 512Mi/1024Mi                                     â”‚
â”‚                                                              â”‚
â”‚  NEXT SCHEDULED CHECK: In 4 hours                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Checklist RÃ¡pido

Use esta checklist apÃ³s cada deploy:

```
POST-DEPLOY CHECKLIST
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Infraestrutura:
â–¡ Pre-Deploy Checks: PASSED
â–¡ Cloud Run Deploy: COMPLETED
â–¡ Post-Deploy Verification: PASSED
â–¡ Service URL: ACCESSIBLE

Funcionalidades:
â–¡ Health Check: âœ…
â–¡ Frontend: âœ…
â–¡ Search API: âœ…
â–¡ AI Analysis: âœ…
â–¡ Elevation API: âœ…
â–¡ DXF Generation: âœ…
â–¡ Cloud Tasks: âœ…
â–¡ Static Assets: âœ…

Monitoramento:
â–¡ Logs: NO ERRORS
â–¡ Metrics: NORMAL
â–¡ Next Health Check: SCHEDULED

Status Final: âœ… DEPLOY SAUDÃVEL E VERIFICADO
```

---

**Este diagrama representa o fluxo completo de deploy com todos os workflows implementados.**

**Para execuÃ§Ã£o manual dos workflows, veja:** `WORKFLOWS_RESUMO.md`
**Para documentaÃ§Ã£o detalhada, veja:** `MONITORING_WORKFLOWS.md`
